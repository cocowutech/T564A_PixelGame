<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Relay: Connect & Compose</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/student.css">
    <link rel="stylesheet" href="styles/teacher.css">
    <link rel="stylesheet" href="styles/tutorial.css">
</head>
<body>
    <div id="app">
        <!-- Landing Page -->
        <div id="landing-page" class="screen active">
            <div class="title-screen">
                <h1 class="pixel-title">Pixel Relay</h1>
                <p class="subtitle">Connect & Compose</p>
                <div class="menu-options">
                    <button id="btn-student" class="menu-btn">Student Mode</button>
                    <button id="btn-teacher" class="menu-btn">Teacher Control Room</button>
                    <button id="btn-how-to-play" class="menu-btn" style="border-color: var(--color-accent); color: var(--color-accent);">How to Play</button>
                </div>
            </div>
        </div>

        <!-- How to Play Tutorial -->
        <div id="how-to-play" class="screen">
            <div class="tutorial-container">
                <h2 style="color: var(--color-primary); text-align: center; margin-bottom: 30px;">How to Play Pixel Relay</h2>

                <div class="tutorial-content">
                    <!-- Game Overview -->
                    <div class="tutorial-section">
                        <h3>üéÆ Game Overview</h3>
                        <p>Pixel Relay is a fast-paced English learning game where you click to connect letters‚Üíwords‚Üísentences with an 8-bit pixel runner. Play solo to practice or join a classroom game to compete with your team!</p>
                    </div>

                    <!-- Game Modes -->
                    <div class="tutorial-section">
                        <h3>üéØ Game Modes</h3>
                        <div class="mode-card">
                            <h4>üìù Alphabet ‚Üí Word (Spelling)</h4>
                            <p><strong>Goal:</strong> Connect letters in the correct order to spell target words.</p>
                            <p><strong>How:</strong> Click letters in order to build the word shown at the top. The game auto-submits when you have the right number of letters!</p>
                            <p><strong>Example:</strong> To spell "LEARNING" ‚Üí click L ‚Üí E ‚Üí A ‚Üí R ‚Üí N ‚Üí I ‚Üí N ‚Üí G</p>
                        </div>

                        <div class="mode-card">
                            <h4>üìñ Word ‚Üí Sentence (Grammar)</h4>
                            <p><strong>Goal:</strong> Connect words in the correct order to build sentences.</p>
                            <p><strong>How:</strong> Click words in order to construct the target sentence. Auto-submits when complete!</p>
                            <p><strong>Example:</strong> "The cat sat on the mat" ‚Üí click each word in order</p>
                        </div>

                        <div class="mode-card">
                            <h4>üîÑ Mixed Relay</h4>
                            <p><strong>Goal:</strong> Complete both spelling AND sentence challenges!</p>
                            <p><strong>How:</strong> First click letters to spell words, then click words to build sentences.</p>
                        </div>
                    </div>

                    <!-- How to Play -->
                    <div class="tutorial-section">
                        <h3>üïπÔ∏è Controls & Gameplay</h3>
                        <div class="controls-grid">
                            <div class="control-item">
                                <div class="control-icon">üñ±Ô∏è</div>
                                <div class="control-desc">
                                    <strong>Click to Select</strong>
                                    <p>Simply click letters/words in order. Lines will connect automatically and it auto-submits when complete!</p>
                                </div>
                            </div>

                            <div class="control-item">
                                <div class="control-icon">‚Ü©Ô∏è</div>
                                <div class="control-desc">
                                    <strong>Undo Button</strong>
                                    <p>Made a mistake? Click Undo or press Ctrl/Cmd+Z to remove the last selection</p>
                                </div>
                            </div>

                            <div class="control-item">
                                <div class="control-icon">üîÑ</div>
                                <div class="control-desc">
                                    <strong>Clear All Button</strong>
                                    <p>Need to start over? Click Clear All or press Esc to remove all selections</p>
                                </div>
                            </div>

                            <div class="control-item">
                                <div class="control-icon">üí°</div>
                                <div class="control-desc">
                                    <strong>Hint Button</strong>
                                    <p>Stuck? Click Hint or press Ctrl/Cmd+H (costs 10 points, limited in Hard mode)</p>
                                </div>
                            </div>

                            <div class="control-item">
                                <div class="control-icon">‚å®Ô∏è</div>
                                <div class="control-desc">
                                    <strong>Keyboard Shortcuts</strong>
                                    <p>Ctrl+Shift+C = High Contrast, Tab = Navigate, Esc = Clear All</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scoring System -->
                    <div class="tutorial-section">
                        <h3>üèÜ Lives & Scoring</h3>
                        <div class="scoring-grid">
                            <div class="score-item correct">
                                <h4>‚úÖ Correct Connection</h4>
                                <p>‚Ä¢ Runner dashes forward</p>
                                <p>‚Ä¢ +100 points √ó chain length</p>
                                <p>‚Ä¢ +1 Life (max 5)</p>
                                <p>‚Ä¢ Progress increases</p>
                            </div>

                            <div class="score-item incorrect">
                                <h4>‚ùå Incorrect Connection</h4>
                                <p>‚Ä¢ Runner stumbles</p>
                                <p>‚Ä¢ -1 Life</p>
                                <p>‚Ä¢ Try again!</p>
                            </div>

                            <div class="score-item lives">
                                <h4>‚ù§Ô∏è Lives System</h4>
                                <p>‚Ä¢ Start with 3 lives</p>
                                <p>‚Ä¢ Earn lives by being correct</p>
                                <p>‚Ä¢ Max 5 lives</p>
                                <p>‚Ä¢ 0 lives = 3 second cooldown, resume with 1 life</p>
                            </div>
                        </div>
                    </div>

                    <!-- Visual Guide -->
                    <div class="tutorial-section">
                        <h3>üëÅÔ∏è Visual Feedback</h3>
                        <div class="visual-guide">
                            <div class="visual-item">
                                <div class="runner-demo">üèÉ</div>
                                <p><strong>Pixel Runner</strong><br>Your character that moves as you connect</p>
                            </div>
                            <div class="visual-item">
                                <div class="visual-color" style="background: var(--color-success);">‚úì</div>
                                <p><strong>Green</strong><br>Correct connections</p>
                            </div>
                            <div class="visual-item">
                                <div class="visual-color" style="background: var(--color-error);">‚úó</div>
                                <p><strong>Red</strong><br>Incorrect connections</p>
                            </div>
                            <div class="visual-item">
                                <div class="visual-color" style="background: var(--color-accent);">?</div>
                                <p><strong>Yellow</strong><br>Target/Selected items</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Tips -->
                    <div class="tutorial-section">
                        <h3>üí™ Pro Tips</h3>
                        <ul class="tips-list">
                            <li>‚ú® <strong>Read the target:</strong> Always check what word/sentence you need to build at the top of the screen</li>
                            <li>‚ö° <strong>Speed matters:</strong> Complete challenges quickly for bonus points</li>
                            <li>üéØ <strong>Accuracy first:</strong> Take your time to avoid losing lives</li>
                            <li>üí° <strong>Use hints wisely:</strong> They cost points, so try without hints first</li>
                            <li>üîÑ <strong>Practice mode:</strong> Try Solo Practice to learn without pressure</li>
                            <li>üë• <strong>Team play:</strong> In multiplayer, your progress helps the whole team</li>
                            <li>‚è±Ô∏è <strong>Watch the timer:</strong> Plan your moves before time runs out</li>
                        </ul>
                    </div>

                    <!-- Getting Started -->
                    <div class="tutorial-section">
                        <h3>üöÄ Getting Started</h3>
                        <div class="getting-started">
                            <div class="start-option">
                                <h4>üéì Solo Practice Mode</h4>
                                <ol>
                                    <li>Click "Student Mode"</li>
                                    <li>Enter your name</li>
                                    <li>Click "Solo Practice Mode"</li>
                                    <li>Choose difficulty, topic, and goal</li>
                                    <li>Start playing immediately!</li>
                                </ol>
                                <p class="note">Perfect for learning and practicing at your own pace</p>
                            </div>

                            <div class="start-option">
                                <h4>üë• Multiplayer Mode</h4>
                                <ol>
                                    <li>Teacher creates a room and shares the code</li>
                                    <li>Click "Student Mode"</li>
                                    <li>Enter your name and room code</li>
                                    <li>Wait for teacher to start</li>
                                    <li>Compete with your classmates!</li>
                                </ol>
                                <p class="note">Work together as a team to achieve Team Complete</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tutorial-footer">
                    <button id="btn-back-tutorial" class="action-btn">Back to Menu</button>
                    <button id="btn-try-tutorial" class="action-btn" style="border-color: var(--color-success); color: var(--color-success);">Try Solo Practice Now!</button>
                </div>
            </div>
        </div>

        <!-- Student Join Screen -->
        <div id="student-join" class="screen">
            <div class="join-container">
                <h2>Student Mode</h2>
                <input type="text" id="student-name" placeholder="Enter your name" class="input-field">

                <div class="mode-divider">
                    <h3 style="color: var(--color-accent); font-size: 14px; margin: 20px 0 10px 0;">Join Multiplayer</h3>
                </div>
                <input type="text" id="room-code" placeholder="Room Code" class="input-field">
                <button id="btn-join" class="action-btn">Join Room</button>

                <div class="mode-divider">
                    <h3 style="color: var(--color-accent); font-size: 14px; margin: 20px 0 10px 0;">Or Play Solo</h3>
                </div>
                <button id="btn-solo-play" class="action-btn" style="border-color: var(--color-secondary); color: var(--color-secondary);">Solo Practice Mode</button>

                <button id="btn-back-student" class="back-btn">Back</button>
            </div>
        </div>

        <!-- Solo Mode Setup Screen -->
        <div id="solo-setup" class="screen">
            <div class="join-container">
                <h2>Solo Practice Mode</h2>
                <p style="color: var(--color-text-dim); margin-bottom: 20px;">Practice at your own pace!</p>

                <label for="solo-mode">Game Mode:</label>
                <select id="solo-mode" class="select-field">
                    <option value="alphabet-word">Alphabet ‚Üí Word (Spelling)</option>
                    <option value="word-sentence">Word ‚Üí Sentence (Grammar)</option>
                    <option value="mixed-relay">Mixed Relay (Both)</option>
                </select>

                <label for="solo-difficulty">Difficulty:</label>
                <select id="solo-difficulty" class="select-field">
                    <option value="easy">Easy (5 minutes, hints enabled)</option>
                    <option value="medium" selected>Medium (3 minutes, limited hints)</option>
                    <option value="hard">Hard (2 minutes, no hints)</option>
                </select>

                <label for="solo-topic">Topic/Theme:</label>
                <select id="solo-topic" class="select-field">
                    <option value="general">General Vocabulary</option>
                    <option value="academic">Academic Words</option>
                    <option value="business">Business English</option>
                    <option value="technology">Technology Terms</option>
                    <option value="custom">Custom (paste text below)</option>
                </select>

                <textarea id="solo-custom-text" placeholder="Paste your custom text here (if Custom selected)..." class="textarea-field" style="display: none; min-height: 100px;"></textarea>

                <label for="solo-goal">Your Goal:</label>
                <select id="solo-goal" class="select-field">
                    <option value="score">High Score Challenge</option>
                    <option value="time">Speed Challenge (complete fastest)</option>
                    <option value="accuracy">Perfect Accuracy (no mistakes)</option>
                    <option value="practice">Free Practice (no pressure)</option>
                </select>

                <button id="btn-start-solo" class="action-btn" style="border-color: var(--color-secondary); color: var(--color-secondary);">Start Solo Game</button>
                <button id="btn-back-solo" class="back-btn">Back</button>
            </div>
        </div>

        <!-- Student Game Board -->
        <div id="student-board" class="screen">
            <div class="game-header">
                <div class="lives-display">
                    <span class="lives-label">Lives:</span>
                    <div id="lives-hearts" class="hearts-container"></div>
                </div>
                <div class="timer-display">
                    <span id="time-remaining">3:00</span>
                </div>
                <div class="score-display">
                    <span class="score-label">Score:</span>
                    <span id="current-score">0</span>
                </div>
            </div>

            <!-- Team Progress Bar -->
            <div class="team-track">
                <div class="track-label">Team Progress</div>
                <div id="team-progress-bar" class="progress-track"></div>
            </div>

            <!-- Game Board -->
            <div id="game-board" class="board-container">
                <canvas id="runner-canvas" class="runner-layer"></canvas>
                <div id="connection-layer" class="connection-layer"></div>
                <div id="nodes-container" class="nodes-container"></div>
            </div>

            <!-- Mini-map for long sentences -->
            <div id="mini-map" class="mini-map hidden"></div>

            <!-- Controls -->
            <div class="game-controls">
                <!-- Target Display (shown by JavaScript) -->
                <div class="target-display">
                    <div id="target-text"></div>
                </div>

                <!-- Current Selection -->
                <div class="selection-display">
                    <div style="font-size: 12px; color: var(--color-text-dim); margin-bottom: 5px;">YOUR SELECTION:</div>
                    <div id="current-selection" style="font-size: 20px; color: var(--color-primary); font-weight: bold; min-height: 30px; letter-spacing: 2px;">
                        (click letters/words below)
                    </div>
                </div>

                <!-- Control Buttons -->
                <div class="controls-row">
                    <button id="btn-undo" class="control-btn">‚Ü©Ô∏è Undo Last</button>
                    <button id="btn-hint" class="control-btn">üí° Hint (-10pts)</button>
                    <button id="btn-clear" class="control-btn" style="border-color: var(--color-error); color: var(--color-error);">üîÑ Clear All</button>
                </div>
            </div>

            <!-- Feedback Modal -->
            <div id="feedback-modal" class="modal hidden">
                <div class="modal-content">
                    <p id="feedback-message"></p>
                </div>
            </div>
        </div>

        <!-- Teacher Login/Setup -->
        <div id="teacher-setup" class="screen">
            <div class="setup-container">
                <h2>Teacher Control Room</h2>
                <div class="setup-section">
                    <h3>Create New Game</h3>
                    <input type="text" id="teacher-name" placeholder="Your Name" class="input-field">

                    <label for="game-mode">Game Mode:</label>
                    <select id="game-mode" class="select-field">
                        <option value="alphabet-word">Alphabet ‚Üí Word</option>
                        <option value="word-sentence">Word ‚Üí Sentence</option>
                        <option value="mixed-relay">Mixed Relay</option>
                    </select>

                    <label for="source-text">Source Text:</label>
                    <textarea id="source-text" placeholder="Paste article or text here..." class="textarea-field"></textarea>

                    <label for="ready-prompt">Or use a ready prompt:</label>
                    <select id="ready-prompt" class="select-field">
                        <option value="">-- Select a prompt --</option>
                        <option value="extract-vocab">Extract 8 key academic words and 3 collocations at B1 level</option>
                        <option value="focus-sentences">Create 2 focus sentences using today's vocabulary in active voice</option>
                        <option value="complex-sentence">Generate 1 complex sentence with a relative clause and 1 with a time adverbial</option>
                    </select>

                    <div class="time-settings">
                        <label for="game-duration">Game Duration (minutes):</label>
                        <input type="number" id="game-duration" value="3" min="1" max="10" class="input-field small">
                    </div>

                    <button id="btn-create-room" class="action-btn">Create Room</button>
                    <button id="btn-back-teacher" class="back-btn">Back</button>
                </div>
            </div>
        </div>

        <!-- Teacher Control Room -->
        <div id="teacher-control" class="screen">
            <div class="control-header">
                <h2>Control Room</h2>
                <div class="room-info">
                    <span>Room Code: <strong id="display-room-code"></strong></span>
                    <span>Mode: <strong id="display-mode"></strong></span>
                    <span>Time: <strong id="control-timer"></strong></span>
                </div>
            </div>

            <div class="control-actions">
                <button id="btn-start-game" class="action-btn">Start Game</button>
                <button id="btn-pause-game" class="action-btn">Pause</button>
                <button id="btn-broadcast-hint" class="action-btn">Broadcast Hint</button>
                <button id="btn-extend-time" class="action-btn">+30s</button>
                <button id="btn-end-game" class="action-btn danger">End Game</button>
            </div>

            <div class="students-grid" id="students-grid">
                <!-- Student cards will be dynamically added -->
            </div>

            <div class="analytics-section">
                <h3>Live Analytics</h3>
                <div id="analytics-display" class="analytics-grid">
                    <!-- Analytics data -->
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <h2>Game Complete!</h2>
                <div id="team-results" class="team-results"></div>
                <div id="individual-results" class="individual-results"></div>
                <button id="btn-new-game" class="action-btn">New Game</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK from CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Game Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/runner-animation.js"></script>
    <script src="js/drag-connect.js"></script>
    <script src="js/game-state.js"></script>
    <script src="js/student-controller.js"></script>
    <script src="js/teacher-controller.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
